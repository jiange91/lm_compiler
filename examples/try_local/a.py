import os
from langchain_openai import ChatOpenAI
from langchain_core.prompts import (
    ChatPromptTemplate,
    HumanMessagePromptTemplate,
    MessagesPlaceholder,
)
from langchain_fireworks import ChatFireworks
from compiler.utils import load_api_key, get_bill


from langchain_core.messages import (
    AIMessage,
    HumanMessage,
    SystemMessage,
    merge_message_runs,
)

load_api_key('secrets.toml')

print('Let me show you some examples following the format:\n\ncontext:\n${context}\n\nquestion:\n${question}\n\nreasoning:\nOptional(${reasoning})\n\nanswer:\n${answer}\n\n---\n\ncontext:\n[\'"1992 Los Angeles Dodgers season" | "1992 Los Angeles Dodgers season The 1992 Los Angeles Dodgers season was a poor one for the team as it finished last in the Western Division of the National League with a record of 63 wins and 99 losses. Despite boasting what was nicknamed the ""Outfield of Dreams"", being manned by Eric Davis, Brett Butler, and Darryl Strawberry, injuries to key players and slumps from others contributed to the franchise\\\'s worst season since moving to Los Angeles. Additionally, the Dodgers cancelled four home games during the season due to the L.A. Riots. Despite the poor finish, the Dodgers had some"\', \'"1992 Los Angeles Dodgers season" | "Pacific. He appeared in six games for the 2000 Anaheim Angels and had two hits in four at-bats. He would later become a AAA manager in the Angels system for the Salt Lake Bees. 1992 Los Angeles Dodgers season The 1992 Los Angeles Dodgers season was a poor one for the team as it finished last in the Western Division of the National League with a record of 63 wins and 99 losses. Despite boasting what was nicknamed the ""Outfield of Dreams"", being manned by Eric Davis, Brett Butler, and Darryl Strawberry, injuries to key players and slumps from others"\']\n\nquestion:\nHaving the combination of excellent foot speed and bat speed helped Eric Davis, create what kind of outfield for the Los Angeles Dodgers? \n\nreasoning:\nN/A\n\nanswer:\nThe "Outfield of Dreams".\n\n---\n\ncontext:\n[\'"Angry Birds Action!" | "Angry Birds Action! Angry Birds Action! was a 2016 pinball video game developed by Tag Games and published by Rovio Entertainment as the thirteenth game in the ""Angry Birds"" series, and the first to have the birds appear like their counterparts in ""The Angry Birds Movie"". It was soft-launched in New Zealand on February 16, 2016 and was released for iOS and Android worldwide on April 28, 2016. It used the basic mechanics of pinball with the various Angry Birds acting as the pinball. It was free-to-play with optional purchases for in-game currency. In October 2017, the game was removed"\', \'"Rio (2011 film)" | "announced: first, by completing an album of stickers, consumers could win three movie passes and medium snack bar combos; second, by finding winning stickers in packages with prizes including a trip to Rio de Janeiro, backpacks, cinema passes for a year, and 3D glasses. The promotion ended on May 30, 2011. The promotion is available in Ecuador, Peru, and Colombia. On January 27, 2011, Rovio Mobile announced a partnership with 20th Century Fox to promote the film. The game ""Angry Birds Rio"" was released in March 2011 on the Android Market and the Apple App Store with 50 levels. Rovio"\', \'"Angry Birds Evolution" | "ran from July 11, 2016 to August 3, 2016 and was only available on iOS. After the beta ended, the game was soft-launched in Hong Kong on August 17, 2016, then was released in more Asian countries in October 2016. On June 15, 2017, the game received a final, global release. This game is a turn-based role-playing game, like ""Angry Birds Epic"", but its battles incorporate the pinball-like elements of ""Angry Birds Action"", in the sense that the player launches birds at a handful of pigs in a rectangular battlefield, bouncing off of its boundaries, obstacles and enemies strategically to"\']\n\nquestion:\nWhere did the game the Angry Birds Movie was based on first launch?\n\nreasoning:\nN/A\n\nanswer:\nNew Zealand.\n\n---\n\ncontext:\n[\'"Joakim Noah" | "six attempts. With the help of Noah on both the offensive and defensive sides of the ball, the Florida Gators were able to win their second championship in two years. The Chicago Bulls selected Noah as the ninth overall pick in the 2007 NBA draft. Noah and his teammates at Florida, Corey Brewer and Al Horford, became the highest-picked trio from the same college in the history of the NBA. Horford was chosen third overall by the Atlanta Hawks, and Brewer was chosen seventh overall by the Minnesota Timberwolves. On November 6, 2007, Noah made his regular season debut off"\', \'"Minnesota Timberwolves" | "ways with David Kahn after the season ended, with Flip Saunders being brought in to replace him. In the 2013 NBA draft, the team traded the 9th overall pick Trey Burke for Shabazz Muhammad (14th pick) and Gorgui Dieng (21st pick) in the first round from the Utah Jazz. On March 28, 2014, the Timberwolves set a franchise record for points in a regular season game with a 143–107 win over the Los Angeles Lakers. The win also marked the Timberwolves\\\' first season-series win over the Lakers since the 2005–06 season. The team accumulated 40 wins for the first time"\', \'"NBA All-Defensive Team" | "each second team vote. The top five players with the highest point total make the first team, with the next five making the second team. In the case of a tie at the fifth position of either team, the roster is expanded. If the first team consists of six players due to a tie, the second team will still consist of five players with the potential for more expansion in the event of additional ties. Ties have occurred several times, most recently in 2013 when Tyson Chandler and Joakim Noah tied in votes received. Tim Duncan holds the record for"\', \'"Joakim Noah" | "was awarded the NBA Defensive Player of the Year award for the first time in his career. He is the second Chicago Bull to win the award, after Michael Jordan who won it in the season. On June 4, 2014, Noah was named to the 2014 All-NBA first team. On January 27, 2015, Noah had a season-best game with 18 points and 15 rebounds in a 113–111 overtime win over the Golden State Warriors. He finished the season averaging 7.2 points and 9.6 rebounds, his lowest averages since the 2009–10 season. Noah lost his starting spot to Nikola Mirotić during"\']\n\nquestion:\nWho did the ninth overall pick in the 2007 NBA draft tie with during voting for the 2013 NBA All-Defensive Team?\n\nreasoning:\nN/A\n\nanswer:\nTyson Chandler.\n\n---\n\ncontext:\n[\'"Rankings of universities in the United States" | "doctorate degrees, and those students who have won one of a diverse array of prestigious academic awards) constitutes 12.5%. Public reputation is not considered, which causes some colleges to score lower than in other lists. A three-year moving average is used to smooth out the scoring. The 2018 ranking puts Harvard University at the top, followed by Yale University, Stanford University, the Massachusetts Institute of Technology, and Princeton University. Reuters ranks the most innovative universities in the world based upon its assessment of the educational institutions ""doing the most to advance science, invent new technologies and power new markets and"\', \'"Massachusetts Institute of Technology" | "world\\\'s ""six super brands"" on its ""World Reputation Rankings"", along with Berkeley, Cambridge, Harvard, Oxford and Stanford. In 2017, the Times Higher Education World University Rankings rated MIT the #2 university for arts and humanities. The university historically pioneered research and training collaborations between academia, industry and government. In 1946, President Compton, Harvard Business School professor Georges Doriot, and Massachusetts Investor Trust chairman Merrill Grisswold founded American Research and Development Corporation, the first American venture-capital firm. In 1948, Compton established the MIT Industrial Liaison Program. Throughout the late 1980s and early 1990s, American politicians and business leaders accused MIT and"\', \'"New York metropolitan area" | "University in Princeton, New Jersey; Yale University in New Haven, Connecticut – all ranked amongst the top 3 U.S. national universities as per ""U.S. News & World Report"" as of 2018 – reside in the region, as well as New York University and The Rockefeller University, both located in Manhattan; all of the above have been ranked amongst the top 35 universities in the world. Rutgers University, a global university located southwest of Manhattan in New Brunswick, New Jersey, is by far the largest university in the region. New York Institute of Technology is located on two campuses, one in"\', \'"CWTS Leiden Ranking" | "and a ""sufficiently large"" number of references in the Web of Science database. As in other university rankings, Leiden\\\'s top 20 is heavily dominated by American universities. In the 2014 rankings, Rockefeller University was first by citation impact, as measured by both mean citation score and mean normalized citation score, as well as by the proportion of papers belonging to the top 10% in their field. Notably, the University of Oxford, the University of Cambridge, and other British universities score much lower than in other university rankings, such as the Times Higher Education World University Rankings and QS World University"\']\n\nquestion:\nAre Rockefeller University and Massachusetts Institute of Technology both considered to be prestigious?\n\nreasoning:\nN/A\n\nanswer:\nYes.\n\n---\n\ncontext:\n[\'"Darby O\\\'Gill and the Little People" | "Darby O\\\'Gill and the Little People Darby O\\\'Gill and the Little People is a 1959 Walt Disney Productions feature film starring Albert Sharpe, Janet Munro, Sean Connery and Jimmy O\\\'Dea, in a tale about a wily Irishman and his battle of wits with leprechauns. The film was directed by Robert Stevenson and its screenplay written by Lawrence Edward Watkin after the books of Herminie Templeton Kavanagh. The film\\\'s title is a slight modification of one of the two Kavanagh books, ""Darby O\\\'Gill and the Good People"". This book and her other book, ""The Ashes of Old Wishes And Other Darby"\', \'"Darby O\\\'Gill and the Little People" | "the wagon for a happy ending, with Michael and Katie singing a final duet together of ""Pretty Irish Girl."" The film\\\'s development began with a visit to Ireland and the Irish Folklore Commission by Walt Disney and associates in 1947. The Disney company continued to liaise with the commission and its director, James Delargy, over the coming decade based on Disney\\\'s desire to use Irish folklore as the basis of a film but, to Delargy\\\'s disappointment, eventually decided to make an adaptation of Irish-American writer Hermione Templeton Kavanagh\\\'s 1903 collection of stories ""Darbie O\\\'Gill and the Good People"". The duet"\']\n\nquestion:\nWhich movie is based on a book, Darby O\'Gill and the Little People and College Road Trip?\n\nreasoning:\nN/A\n\nanswer:\nDarby O\'Gill and the Little People\n\n---\n\ncontext:\n[\'"Bernard J. Schaffer" | "Bernard J. Schaffer Bernard J. Schaffer (born 1974) is a police detective, an author, and a former child actor who appeared on the Nickelodeon program ""Don\\\'t Just Sit There"". He joined the police department in 1996 and passed the detective\\\'s test in 2005. Schaffer cites Stephen King\\\'s """" as his favorite book, describing King as ""my Musashi,"" and the ""Harry Potter"" novels as his favorite series. Schaffer has self-published several works, including: He is also the founder of the short-fiction anthology ""Kindle All-Stars"", contributing the Seneca 6 story ""Old-Time Lawmen"" to the first collection, ""Resistance Front"", and the story ""Carnival"\', \'"Bernard J. Schaffer" | "of Cryptids"" in the second collection, ""Carnival of Crypids"". His upcoming projects include the historical sequel ""Whitechapel 2: Inspector Lestrade and the Torso Killer"", the sword-and-sorcery fantasy story ""The Widow Sword"", and a third installment of the ""Kindle All-Stars"" anthology. Bernard J. Schaffer Bernard J. Schaffer (born 1974) is a police detective, an author, and a former child actor who appeared on the Nickelodeon program ""Don\\\'t Just Sit There"". He joined the police department in 1996 and passed the detective\\\'s test in 2005. Schaffer cites Stephen King\\\'s """" as his favorite book, describing King as ""my Musashi,"" and the ""Harry"\']\n\nquestion:\nA police detective, author and former child actor who appeared on a show that had segments about making food and taking things apart, joined the police department in what year?\n\nreasoning:\nN/A\n\nanswer:\n1996\n\n---\n\ncontext:\n[\'"The Devil and Max Devlin" | "The Devil and Max Devlin The Devil and Max Devlin is a 1981 American fantasy-comedy film produced by Walt Disney Productions, directed by Steven Hilliard Stern and starring Elliott Gould, Bill Cosby and Susan Anspach. The film was considered to be controversial for a Disney film at the time because of the subject matter and the fact that Bill Cosby was featured as a character of evil, and was one of three motion pictures that influenced Disney to establish Touchstone Pictures and Hollywood Pictures (and later, to purchase Miramax Films), as a method to produce and release films for mature"\', \'"The Devil and Max Devlin" | "US in late 1981 and then discontinued for years in spite of Bill Cosby\\\'s renewed TV popularity because of ""The Cosby Show"" (which started its eight-year run in 1984, the same year Elliott Gould\\\'s sitcom ""E/R"" came and went), Anchor Bay Entertainment released the film on DVD in November 2000, and Walt Disney Home Entertainment re-released it on DVD in 2006. In the UK, ironically considering the film\\\'s English origins, its 1987 videocassette debut caused a minor stir as it coincided with the growing uproar over ""Video nasties,"" the press-generated term for films with gory violence and explicit sex. Anti-censorship"\', \'"The Devil and Max Devlin" | "incorporated footage of bodies marching from 1979\\\'s ""The Black Hole"". In addition to the musical score by Buddy Baker, the film features two songs composed by Marvin Hamlisch and sung by Julie Budd: ""Any Fool Could See"" (lyrics by Allee Willis) and ""Roses and Rainbows"" (lyrics by Carole Bayer Sager). They were released as a single on both the A&M Records and Buena Vista Records labels in both the US and the UK, but it did not chart. To date, neither the two singles nor the film\\\'s underscore have received any kind of release on CD, but Julie Budd rerecorded"\']\n\nquestion:\nWas The Devil and Max Devlin or Do Dooni Chaar released first?\n\nreasoning:\nN/A\n\nanswer:\nThe Devil and Max Devlin\n\n---\n\ncontext:\n[\'"Juan Pablo Di Pace" | "2005 film ""Survival Island"". He is also featured in ""Mamma Mia!"" (2008). Upon moving to Spain he played regular roles in TV series such as ""Supercharly"", ""Angel o Demonio"", ""Los Hombres de Paco"", ""90-60-90"", and ""El Don de Alba"". In 2011 he starred in the final season of ""Física o Química,"". Di Pace also starred in the video for the 2004 Eric Prydz hit ""Call On Me"". In the video, he is the only man amongst a group of women in an aerobics class. He also directed and starred in the sequel ""What a Feeling"" by Hughes Corporation in 2006,"\', \'"Juan Pablo Di Pace" | "Juan Pablo Di Pace Juan Pablo Di Pace is an Argentinian actor, singer and director. Di Pace began his career in the United Kingdom, performing in a number of musicals and appearing in films like ""Survival Island"" (2005) and ""Mamma Mia!"" (2008). He later moved to Spain, starring in several television series from 2009 to 2013. In 2014, Di Pace began starring as Nicolas Treviño in the TNT drama series ""Dallas"". Starting in 2016, he played the role of Kimmy Gibbler\\\'s estranged husband, Fernando, on ""Fuller House"", the sequel series to ""Full House"". Di Pace was born in Buenos Aires,"\', \'"Full House (UK TV series)" | "Full House (UK TV series) Full House is a British sitcom which aired for three series from 1985 to 1986. It was the last sitcom to be jointly co-created by the sitcom writing team of Johnnie Mortimer and Brian Cooke, however, it was mainly written by Mortimer alone, with Mortimer writing 12 episodes alone, along with a further 3 with Cooke, while another veteran sitcom writer, Vince Powell, contributed another 3. It starred Christopher Strauli, Sabina Franklyn, Brian Capron and Natalie Forbes, with Diana King, who was later replaced by Joan Sanderson. It was made by Thames Television for the"\', \'"Full House (Philippine TV series)" | "Full House (Philippine TV series) Full House is a Philippine television drama romance comedy series broadcast by GMA Network. The series is adaptation of a 2004 Korean television series of the same title. Directed by Mark A. Reyes, it stars Richard Gutierrez and Heart Evangelista. It premiered on November 30, 2009 on the network\\\'s Telebabad line up replacing ""Rosalinda"" and worldwide on GMA Pinoy TV. The series concluded on February 26, 2010 with a total of 65 episodes. It was replaced by ""Diva"" in its timeslot. According to AGB Nielsen Philippines\\\' Mega Manila household television ratings, the pilot episode of"\']\n\nquestion:\nJuan Pablo Di Pace had a role on the sequel series to what Jeff Franklin-created American sitcom?\n\nreasoning:\nN/A\n\nanswer:\nFull House\n\n---\n\n')
exit()

# llm = ChatOpenAI(
#     api_key="EMPTY",
#     openai_api_base="http://192.168.1.16:30000/v1",
#     model="meta-llama/Llama-3.1-8B-Instruct",
# )

llm = ChatFireworks(
    api_key=os.environ['FIREWORKS_API_KEY'],
    model="accounts/zih015-63d1a0/deployedModels/llama-v3p1-8b-instruct-46c7347d",
)

chat_prompt = ChatPromptTemplate.from_messages(
    [
        HumanMessage("Given a series of chess moves written in Standard Algebraic Notation (SAN), give the next move that will result in a checkmate."), 
        HumanMessagePromptTemplate.from_template("moves:\n {input}\n Give your answer in JSON format. Let's think step by step.")
    ]
)

solver = chat_prompt | llm
print(
    solver.invoke({"input": "1. d4 d5 2. Nf3 Nf6 3. e3 a6 4. Nc3 e6 5. Bd3 h6 6. e4 dxe4 7. Bxe4 Nxe4 8. Nxe4 Bb4+ 9. c3 Ba5 10. Qa4+ Nc6 11. Ne5 Qd5 12. f3 O-O 13. Nxc6 bxc6 14. Bf4 Ra7 15. Qb3 Qb5 16. Qxb5 cxb5 17. a4 bxa4 18. Rxa4 Bb6 19. Kf2 Bd7 20. Ke3 Bxa4 21. Ra1 Bc2 22. c4 Bxe4 23. fxe4 c5 24. d5 exd5 25. exd5 Re8+ 26. Kf3 Rae7 27. Rxa6 Bc7 28. Bd2 Re2 29. Bc3 R8e3+ 30. Kg4 Rxg2+ 31. Kf5"}).content
)
